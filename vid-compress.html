<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image Tools Hub</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: auto;
      text-align: center;
    }
    h1 {
      margin-bottom: 30px;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .option {
      padding: 15px 20px;
      background: #ffffff;
      border: 2px solid #007bff;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .option.active, .option:hover {
      background: #007bff;
      color: #fff;
    }
    .drop-zone {
      border: 2px dashed #007bff;
      border-radius: 12px;
      padding: 40px;
      background: #fff;
      transition: background 0.3s;
    }
    .drop-zone.hover {
      background: #e3f2fd;
    }
    canvas {
      margin-top: 20px;
      max-width: 100%;
    }
    .controls {
      margin-top: 20px;
    }
    .controls button {
      padding: 10px 20px;
      margin: 10px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .controls button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Image Editor (Frontend Only)</h1>
    <div class="options">
      <div class="option" onclick="toggleTool('grayscale')">Grayscale</div>
      <div class="option" onclick="toggleTool('blur')">Blur</div>
      <div class="option" onclick="toggleTool('enhance')">Enhance</div>
      <div class="option" onclick="toggleTool('invert')">Invert Colors</div>
      <div class="option" onclick="toggleTool('rotate')">Rotate</div>
      <div class="option" onclick="toggleTool('crop')">Crop</div>
    </div>
    <div class="drop-zone" id="dropZone">
      <p>Drag & drop your image here or click to select</p>
      <input type="file" accept="image/*" style="display:none" id="fileInput">
    </div>
    <canvas id="canvas"></canvas>
    <div class="controls">
      <button onclick="applyTools()">Apply Tools</button>
      <button onclick="chooseDownloadFormat()">Download</button>
    </div>
  </div>

  <script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext("2d");
    let selectedTools = [];
    let loadedImage = null;
    let rotationDegrees = 0;
    let cropStart = null;
    let cropEnd = null;
    let cropping = false;

    function toggleTool(tool) {
      const index = selectedTools.indexOf(tool);
      const element = document.querySelector(`.option[onclick*="${tool}"]`);
      if (index > -1) {
        selectedTools.splice(index, 1);
        element.classList.remove('active');
      } else {
        selectedTools.push(tool);
        element.classList.add('active');
      }
    }

    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => {
      if (e.target.files[0]) handleImage(e.target.files[0]);
    });
    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('hover');
    });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('hover'));
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('hover');
      if (e.dataTransfer.files[0]) handleImage(e.dataTransfer.files[0]);
    });

    function handleImage(file) {
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => {
          loadedImage = img;
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    canvas.addEventListener('mousedown', e => {
      if (!selectedTools.includes('crop')) return;
      cropping = true;
      const rect = canvas.getBoundingClientRect();
      cropStart = { x: e.clientX - rect.left, y: e.clientY - rect.top };
    });

    canvas.addEventListener('mouseup', e => {
      if (!selectedTools.includes('crop') || !cropping) return;
      cropping = false;
      const rect = canvas.getBoundingClientRect();
      cropEnd = { x: e.clientX - rect.left, y: e.clientY - rect.top };
      applyTools();
    });

    function applyTools() {
      if (!loadedImage) return;
      let tempCanvas = document.createElement('canvas');
      let tempCtx = tempCanvas.getContext('2d');
      tempCanvas.width = loadedImage.width;
      tempCanvas.height = loadedImage.height;
      tempCtx.drawImage(loadedImage, 0, 0);

      if (selectedTools.includes('grayscale')) {
        let imgData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
        for (let i = 0; i < imgData.data.length; i += 4) {
          const avg = (imgData.data[i] + imgData.data[i + 1] + imgData.data[i + 2]) / 3;
          imgData.data[i] = imgData.data[i + 1] = imgData.data[i + 2] = avg;
        }
        tempCtx.putImageData(imgData, 0, 0);
      }

      if (selectedTools.includes('blur')) {
        tempCtx.filter = 'blur(5px)';
        tempCtx.drawImage(tempCanvas, 0, 0);
        tempCtx.filter = 'none';
      }

      if (selectedTools.includes('enhance')) {
        tempCtx.filter = 'brightness(1.2) contrast(1.2)';
        tempCtx.drawImage(tempCanvas, 0, 0);
        tempCtx.filter = 'none';
      }

      if (selectedTools.includes('invert')) {
        let imgData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
        for (let i = 0; i < imgData.data.length; i += 4) {
          imgData.data[i] = 255 - imgData.data[i];
          imgData.data[i + 1] = 255 - imgData.data[i + 1];
          imgData.data[i + 2] = 255 - imgData.data[i + 2];
        }
        tempCtx.putImageData(imgData, 0, 0);
      }

      if (selectedTools.includes('rotate')) {
        const degrees = parseInt(prompt("Enter rotation degrees (e.g. 90, 180):", "90")) || 0;
        const radians = degrees * Math.PI / 180;
        const rotatedCanvas = document.createElement('canvas');
        const isVertical = degrees % 180 !== 0;
        rotatedCanvas.width = isVertical ? tempCanvas.height : tempCanvas.width;
        rotatedCanvas.height = isVertical ? tempCanvas.width : tempCanvas.height;
        const rotatedCtx = rotatedCanvas.getContext('2d');
        rotatedCtx.translate(rotatedCanvas.width / 2, rotatedCanvas.height / 2);
        rotatedCtx.rotate(radians);
        rotatedCtx.drawImage(tempCanvas, -tempCanvas.width / 2, -tempCanvas.height / 2);
        tempCanvas = rotatedCanvas;
      }

      if (selectedTools.includes('crop') && cropStart && cropEnd) {
        const x = Math.min(cropStart.x, cropEnd.x);
        const y = Math.min(cropStart.y, cropEnd.y);
        const width = Math.abs(cropEnd.x - cropStart.x);
        const height = Math.abs(cropEnd.y - cropStart.y);
        const cropCanvas = document.createElement('canvas');
        cropCanvas.width = width;
        cropCanvas.height = height;
        cropCanvas.getContext('2d').drawImage(tempCanvas, x, y, width, height, 0, 0, width, height);
        tempCanvas = cropCanvas;
        cropStart = cropEnd = null;
      }

      canvas.width = tempCanvas.width;
      canvas.height = tempCanvas.height;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(tempCanvas, 0, 0);
    }

    function chooseDownloadFormat() {
      const format = prompt("Enter download format: png or jpg").toLowerCase();
      if (format === 'png' || format === 'jpg' || format === 'jpeg') {
        downloadImage(format === 'jpg' ? 'jpeg' : format);
      } else {
        alert('Invalid format. Please enter png or jpg.');
      }
    }

    function downloadImage(type) {
      const link = document.createElement('a');
      link.download = `edited-image.${type}`;
      link.href = canvas.toDataURL(`image/${type}`);
      link.click();
    }
  </script>
</body>
</html>
