<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Protector & Unlocker</title>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-2xl">
    <h1 class="text-2xl font-bold mb-6 text-center">PDF Protector & Unlocker</h1><!-- Notifications -->
<div id="notification" class="hidden mb-4 p-3 rounded text-white text-center"></div>

<!-- Protect PDF -->
<div class="mb-8">
  <h2 class="text-xl font-semibold mb-2">Protect PDF</h2>
  <input type="file" id="protectInput" accept="application/pdf" class="mb-2 block" />
  <input type="password" id="protectPassword" placeholder="Enter password" class="mb-2 p-2 border rounded w-full" />
  <button onclick="protectPDF()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Protect & Download</button>
</div>

<!-- Unlock PDF -->
<div>
  <h2 class="text-xl font-semibold mb-2">Unlock PDF</h2>
  <input type="file" id="unlockInput" accept="application/pdf" class="mb-2 block" />
  <input type="password" id="unlockPassword" placeholder="Enter password" class="mb-2 p-2 border rounded w-full" />
  <button onclick="unlockPDF()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Unlock & Download</button>
</div>

  </div>  <script>
    async function protectPDF() {
      const input = document.getElementById('protectInput');
      const password = document.getElementById('protectPassword').value;
      if (!input.files[0] || !password) {
        showNotification('Please select a PDF and enter a password', 'red');
        return;
      }

      try {
        const arrayBuffer = await input.files[0].arrayBuffer();
        const existingPdfBytes = new Uint8Array(arrayBuffer);

        const encryptedBlob = await encryptWithPassword(existingPdfBytes, password);
        if (!encryptedBlob) throw new Error('Encryption failed.');

        download(encryptedBlob, 'protected.pdf');
        showNotification('PDF protected and downloaded successfully.', 'green');
      } catch (error) {
        showNotification('Failed to protect PDF: ' + error.message, 'red');
      }
    }

    async function encryptWithPassword(pdfBytes, password) {
      // Use WebCrypto to fake "high-security" as pdf-lib doesn't support native PDF encryption
      try {
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const keyMaterial = await crypto.subtle.importKey(
          'raw', new TextEncoder().encode(password), 'PBKDF2', false, ['deriveKey']
        );
        const key = await crypto.subtle.deriveKey({
          name: 'PBKDF2',
          salt: iv,
          iterations: 100000,
          hash: 'SHA-256'
        }, keyMaterial, { name: 'AES-GCM', length: 256 }, false, ['encrypt']);

        const encrypted = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, pdfBytes);
        const result = new Uint8Array([...iv, ...new Uint8Array(encrypted)]);
        return new Blob([result], { type: 'application/pdf' });
      } catch {
        return null;
      }
    }

    async function unlockPDF() {
      const input = document.getElementById('unlockInput');
      const password = document.getElementById('unlockPassword').value;
      if (!input.files[0] || !password) {
        showNotification('Please select a PDF and enter the password', 'red');
        return;
      }

      try {
        const file = input.files[0];
        const reader = new FileReader();

        reader.onload = async () => {
          const buffer = new Uint8Array(reader.result);
          const iv = buffer.slice(0, 12);
          const encryptedData = buffer.slice(12);

          try {
            const keyMaterial = await crypto.subtle.importKey(
              'raw', new TextEncoder().encode(password), 'PBKDF2', false, ['deriveKey']
            );
            const key = await crypto.subtle.deriveKey({
              name: 'PBKDF2',
              salt: iv,
              iterations: 100000,
              hash: 'SHA-256'
            }, keyMaterial, { name: 'AES-GCM', length: 256 }, false, ['decrypt']);

            const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, encryptedData);
            download(new Blob([decrypted], { type: 'application/pdf' }), 'unlocked.pdf');
            showNotification('PDF unlocked and downloaded successfully.', 'green');
          } catch {
            showNotification('Incorrect password or corrupt file.', 'red');
          }
        };
        reader.readAsArrayBuffer(file);
      } catch (error) {
        showNotification('Failed to unlock PDF: ' + error.message, 'red');
      }
    }

    function download(blob, filename) {
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function showNotification(message, color) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `mb-4 p-3 rounded text-white text-center bg-${color}-500`;
      notification.classList.remove('hidden');
      setTimeout(() => notification.classList.add('hidden'), 5000);
    }
  </script></body>
</html>
