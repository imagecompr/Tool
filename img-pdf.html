<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Protector & Unlocker</title>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-2xl">
    <h1 class="text-2xl font-bold mb-6 text-center">PDF Protector & Unlocker</h1><!-- Protect PDF -->
<div class="mb-8">
  <h2 class="text-xl font-semibold mb-2">Protect PDF</h2>
  <input type="file" id="protectInput" accept="application/pdf" class="mb-2 block" />
  <input type="password" id="protectPassword" placeholder="Enter password" class="mb-2 p-2 border rounded w-full" />
  <button onclick="protectPDF()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Protect & Download</button>
</div>

<!-- Unlock PDF -->
<div>
  <h2 class="text-xl font-semibold mb-2">Unlock PDF</h2>
  <input type="file" id="unlockInput" accept="application/pdf" class="mb-2 block" />
  <input type="password" id="unlockPassword" placeholder="Enter password" class="mb-2 p-2 border rounded w-full" />
  <button onclick="unlockPDF()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Unlock & Download</button>
</div>

  </div>  <script>
    async function protectPDF() {
      const input = document.getElementById('protectInput');
      const password = document.getElementById('protectPassword').value;
      if (!input.files[0] || !password) {
        alert('Please select a PDF and enter a password');
        return;
      }

      const arrayBuffer = await input.files[0].arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
      const bytes = await pdfDoc.save({
        passwords: {
          user: password,
          owner: password,
          permissions: {
            printing: 'none',
            modifying: false,
            copying: false,
            annotating: false
          }
        }
      }).catch(() => alert('Encryption failed. Try another file or method.'));

      if (!bytes) return;
      download(bytes, 'protected.pdf');
    }

    async function unlockPDF() {
      const input = document.getElementById('unlockInput');
      const password = document.getElementById('unlockPassword').value;
      if (!input.files[0] || !password) {
        alert('Please select a PDF and enter the password');
        return;
      }

      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = async function () {
        const loadingTask = pdfjsLib.getDocument({
          data: reader.result,
          password: password
        });

        try {
          const pdf = await loadingTask.promise;
          const pdfDoc = await PDFLib.PDFDocument.create();

          for (let i = 0; i < pdf.numPages; i++) {
            const page = await pdf.getPage(i + 1);
            const img = await page.render({
              canvasContext: document.createElement('canvas').getContext('2d'),
              viewport: page.getViewport({ scale: 1 })
            }).promise;

            const copied = await PDFLib.PDFDocument.load(await pdf.getData());
            const [embeddedPage] = await pdfDoc.copyPages(copied, [i]);
            pdfDoc.addPage(embeddedPage);
          }

          const bytes = await pdfDoc.save();
          download(bytes, 'unlocked.pdf');
        } catch (err) {
          alert('Failed to unlock PDF. Check your password.');
        }
      };

      reader.readAsArrayBuffer(file);
    }

    function download(bytes, filename) {
      const blob = new Blob([bytes], { type: 'application/pdf' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }
  </script></body>
</html>
